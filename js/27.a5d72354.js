(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[27],{c124:function(a,t,e){"use strict";e.r(t);e("caad");var s=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"row col full-width q-pa-lg"},[t("q-card",{staticClass:"full-width",attrs:{flat:"",bordered:""}},[t("q-card-section",{staticClass:"text-h6 text-bold"},[a._v("\n        Canais de Comunicação\n        "),t("q-separator")],1)],1)],1),t("div",{staticClass:"row full-width q-py-lg q-px-md"},[a._l(a.whatsapps,(function(e){return[t("q-card",{key:e.id,staticClass:"col-xs-12 col-sm-5 col-md-4 col-lg-3 q-ma-md",attrs:{flat:"",bordered:""}},[t("q-item",[t("q-item-section",{attrs:{avatar:""}},[t("q-avatar",[t("q-icon",{attrs:{size:"40px",name:`img:${e.type}-logo.png`}})],1)],1),t("q-item-section",[t("q-item-label",{staticClass:"text-h6 text-bold"},[a._v("Nome: "+a._s(e.name))]),t("q-item-label",{staticClass:"text-h6 text-caption"},[a._v("\n              "+a._s(e.type)+"\n            ")])],1),t("q-item-section",{attrs:{side:""}},[a.isAdmin?t("q-btn",{attrs:{round:"",flat:"",dense:"",icon:"edit"},on:{click:function(t){return a.handleOpenModalWhatsapp(e)}}}):a._e()],1)],1),t("q-separator"),t("q-card-section",[t("ItemStatusChannel",{attrs:{item:e}}),"messenger"===e.type?[t("div",{staticClass:"text-body2 text-bold q-mt-sm"},[t("span",[a._v(" Página: ")]),a._v("\n              "+a._s(e.fbObject&&e.fbObject.name||"Nenhuma página configurada.")+"\n            ")])]:a._e()],2),t("q-separator"),t("q-card-actions",{staticClass:"q-gutter-md q-pa-md q-pt-none",attrs:{align:"center"}},["messenger"!==e.type?["whatsapp"==e.type&&"qrcode"==e.status?t("q-btn",{attrs:{color:"blue-5",label:"QR Code","icon-right":"watch_later",disable:!a.isAdmin},on:{click:function(t){return a.handleOpenQrModal(e,"btn-qrCode")}}}):a._e(),"DISCONNECTED"==e.status?t("div",{staticClass:"q-gutter-sm"},[t("q-btn",{attrs:{color:"positive",label:"Conectar"},on:{click:function(t){return a.handleStartWhatsAppSession(e.id)}}}),"DISCONNECTED"==e.status&&"whatsapp"==e.type?t("q-btn",{attrs:{color:"blue-5",label:"Novo QR Code","icon-right":"watch_later",disable:!a.isAdmin},on:{click:function(t){return a.handleRequestNewQrCode(e,"btn-qrCode")}}}):a._e()],1):a._e(),"OPENING"==e.status?t("div",{staticClass:"row items-center q-gutter-sm flex flex-inline"},[t("div",{staticClass:"text-bold"},[a._v("\n                Conectando\n              ")]),t("q-spinner-radio",{attrs:{color:"positive",size:"2em"}}),t("q-separator",{attrs:{vertical:"",spaced:""}})],1):a._e(),["OPENING","CONNECTED","PAIRING","TIMEOUT"].includes(e.status)?t("q-btn",{staticClass:"q-mx-sm",attrs:{color:"negative",label:"Desconectar",disable:!a.isAdmin},on:{click:function(t){return a.handleDisconectWhatsSession(e.id)}}}):a._e()]:a._e(),"messenger"===e.type?[t("VFacebookLogin",{attrs:{"app-id":a.cFbAppId,"login-options":a.FBLoginOptions,version:"v12.0"},on:{"sdk-init":a.handleSdkInit,login:t=>a.fbLogin(t,e),logout:t=>a.fbLogout(e)}},[t("template",{slot:"login"},[a._v("\n                "+a._s("CONNECTED"===e.status?"Editar":"Conectar")+"\n              ")]),t("template",{slot:"logout"},[a._v("\n                "+a._s("DISCONNECTED"===e.status?"Conectar":"Editar")+"\n              ")])],2)]:a._e()],2)],1)]}))],2),t("ModalQrCode",{attrs:{abrirModalQR:a.abrirModalQR,channel:a.cDadosWhatsappSelecionado},on:{"update:abrirModalQR":function(t){a.abrirModalQR=t},"update:abrir-modal-q-r":function(t){a.abrirModalQR=t},"gerar-novo-qrcode":t=>a.handleRequestNewQrCode(t,"btn-qrCode")}}),t("ModalWhatsapp",{attrs:{modalWhatsapp:a.modalWhatsapp,whatsAppEdit:a.whatsappSelecionado},on:{"update:modalWhatsapp":function(t){a.modalWhatsapp=t},"update:modal-whatsapp":function(t){a.modalWhatsapp=t},"update:whatsAppEdit":function(t){a.whatsappSelecionado=t},"update:whats-app-edit":function(t){a.whatsappSelecionado=t}}}),t("q-inner-loading",{attrs:{showing:a.loading}},[t("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},i=[],o=e("5c26"),n=e("b166"),l=e("e3ee"),r=e("d9d6"),d=e.n(r),c=function(){var a=this,t=a._self._c;return t("q-dialog",{attrs:{value:a.abrirModalQR,persistent:""},on:{hide:a.fecharModalQrModal}},[t("q-card",{staticStyle:{}},[t("q-card-section",[t("div",{staticClass:"text-h6 text-primary"},[a._v("\n        Leia o QrCode para iniciar a sessão\n        "),t("q-btn",{staticClass:"q-ml-md",attrs:{round:"",color:"negative",icon:"mdi-close"},on:{click:a.fecharModalQrModal}})],1)]),t("q-card-section",{staticClass:"text-center",style:a.$q.dark.isActive?"background: white !important":""},[a.cQrcode?t("QrcodeVue",{attrs:{value:a.cQrcode,size:300,level:"H"}}):t("span",[a._v("\n        Aguardando o Qr Code\n      ")])],1),t("q-card-section",[t("div",{staticClass:"row"},[a._v("Caso tenha problema com a leitura, solicite um novo Qr Code ")]),t("div",{staticClass:"row col-12 justify-center"},[t("q-btn",{attrs:{color:"primary",glossy:"",ripple:"",outline:"",label:"Novo QR Code",icon:"watch_later"},on:{click:a.solicitarQrCode}})],1)])],1)],1)},p=[],h=e("d7b0"),m={name:"ModalQrCode",components:{QrcodeVue:h["a"]},props:{abrirModalQR:{type:Boolean,default:!1},channel:{type:Object,default:()=>({id:null,qrcode:""})}},watch:{channel:{handler(a){"CONNECTED"===this.channel.status&&this.fecharModalQrModal()},deep:!0}},computed:{cQrcode(){return this.channel.qrcode}},methods:{solicitarQrCode(){this.$emit("gerar-novo-qrcode",this.channel),this.fecharModalQrModal()},fecharModalQrModal(){this.$emit("update:abrirModalQR",!1)}}},u=m,g=e("2877"),b=e("24e8"),f=e("f09f"),w=e("a370"),v=e("9c40"),C=e("eebe"),q=e.n(C),y=Object(g["a"])(u,c,p,!1,null,"132f6904",null),_=y.exports;q()(y,"components",{QDialog:b["a"],QCard:f["a"],QCardSection:w["a"],QBtn:v["a"]});var Q=e("2f62"),S=function(){var a=this,t=a._self._c;return t("q-dialog",{attrs:{value:a.modalWhatsapp,persistent:""},on:{hide:a.fecharModal,show:a.abrirModal}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[t("q-icon",{staticClass:"q-mr-md",attrs:{size:"50px",name:`img:${a.whatsapp.type}-logo.png`}}),a._v(" "+a._s(a.whatsapp.id?"Editar":"Adicionar")+" Canal\n      ")],1)]),t("q-card-section",[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("c-input",{attrs:{outlined:"",label:"Nome",validator:a.$v.whatsapp.name},on:{blur:a.$v.whatsapp.name.$touch},model:{value:a.whatsapp.name,callback:function(t){a.$set(a.whatsapp,"name",t)},expression:"whatsapp.name"}})],1),"messenger"===a.whatsapp.type?[t("VFacebookLogin",{attrs:{"app-id":a.cFbAppId,"login-options":a.FBLoginOptions,version:"v12.0"},on:{"sdk-init":a.handleSdkInit,login:a.fbLogin}})]:a._e(),"telegram"===a.whatsapp.type?t("div",{staticClass:"col-12 q-mt-md"},[t("c-input",{attrs:{outlined:"",label:"Token Telegram"},model:{value:a.whatsapp.tokenTelegram,callback:function(t){a.$set(a.whatsapp,"tokenTelegram",t)},expression:"whatsapp.tokenTelegram"}})],1):a._e(),"instagram"===a.whatsapp.type?t("div",{staticClass:"q-mt-md row full-width justify-center"},[t("div",{staticClass:"col"},[t("fieldset",{staticClass:"full-width q-pa-md"},[t("legend",[a._v("Dados da conta do Instagram")]),"instagram"===a.whatsapp.type?t("div",{staticClass:"col-12 q-mb-md"},[t("c-input",{attrs:{outlined:"",label:"Usuário",hint:"Seu usário do Instagram (sem @)"},model:{value:a.whatsapp.instagramUser,callback:function(t){a.$set(a.whatsapp,"instagramUser",t)},expression:"whatsapp.instagramUser"}})],1):a._e(),"instagram"!==a.whatsapp.type||a.isEdit?a._e():t("div",{staticClass:"text-center"},[t("q-btn",{staticClass:"bg-padrao",attrs:{flat:"",color:"info",icon:"edit",label:"Nova senha"},on:{click:function(t){a.isEdit=!a.isEdit}}},[t("q-tooltip",[a._v("\n                    Alterar senha\n                  ")])],1)],1),"instagram"===a.whatsapp.type&&a.isEdit?t("div",{staticClass:"col-12"},[t("c-input",{attrs:{filled:"",label:"Senha",type:a.isPwd?"password":"text",hint:"Senha utilizada para logar no Instagram",placeholder:"*************",disable:!a.isEdit},scopedSlots:a._u([{key:"after",fn:function(){return[t("q-btn",{staticClass:"bg-padrao",attrs:{round:"",flat:"",color:"negative",icon:"mdi-close"},on:{click:function(t){a.isEdit=!a.isEdit}}},[t("q-tooltip",[a._v("\n                        Cancelar alteração de senha\n                      ")])],1)]},proxy:!0},{key:"append",fn:function(){return[t("q-icon",{staticClass:"cursor-pointer",attrs:{name:a.isPwd?"visibility_off":"visibility"},on:{click:function(t){a.isPwd=!a.isPwd}}})]},proxy:!0}],null,!1,4120386499),model:{value:a.whatsapp.instagramKey,callback:function(t){a.$set(a.whatsapp,"instagramKey",t)},expression:"whatsapp.instagramKey"}})],1):a._e()])])]):a._e()],2),t("div",{staticClass:"row q-my-md"},[t("div",{staticClass:"col-12"},[t("label",{staticClass:"text-caption"},[a._v("Mensagem de Saudação do Atendimento:")]),t("textarea",{ref:"inputGreetingMessage",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:a.whatsapp.greetingMessage},on:{input:t=>a.whatsapp.greetingMessage=t.target.value}})])]),t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("label",{staticClass:"text-caption"},[a._v("Mensagem de Despedida do Atendimento:")]),t("textarea",{ref:"inputFarewellMessage",staticClass:"q-pa-sm bg-white full-width",staticStyle:{"min-height":"15vh","max-height":"15vh"},attrs:{placeholder:"Digite a mensagem",autogrow:"",dense:"",outlined:""},domProps:{value:a.whatsapp.farewellMessage},on:{input:t=>a.whatsapp.farewellMessage=t.target.value}})]),t("div",{domProps:{innerHTML:a._s(" Variáveis: <br>{{nomecontato}}  {{nomeatendente}}  {{atendimentonumero}}  {{saudacao}}")}})])]),t("q-card-actions",{staticClass:"q-mt-lg",attrs:{align:"center"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-px-md q-mr-lg",attrs:{flat:"",label:"Sair",color:"negative"}}),t("q-btn",{staticClass:"q-px-md",attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:function(t){return a.handleSaveWhatsApp(a.whatsapp)}}})],1)],1)],1)},M=[],k=e("b5ae"),A=e("446a"),x=e("cdde"),O={components:{cInput:A["a"]},name:"ModalWhatsapp",props:{modalWhatsapp:{type:Boolean,default:!1},whatsAppId:{type:Number,default:null},whatsAppEdit:{type:Object,default:()=>{}}},data(){return{isPwd:!0,isEdit:!1,whatsapp:{name:"",isDefault:!1,tokenTelegram:"",instagramUser:"",instagramKey:"",tokenAPI:"",greetingMessage:"",farewellMessage:""}}},validations:{whatsapp:{name:{required:k["required"],minLength:Object(k["minLength"])(3),maxLength:Object(k["maxLength"])(50)},isDefault:{}}},computed:{"cBaseUrlIntegração"(){return this.whatsapp.UrlMessengerWebHook}},methods:{copy(a){Object(x["a"])(a).then(this.$notificarSucesso("URL de integração copiada!")).catch()},fecharModal(){this.whatsapp={name:"",greetingMessage:"",farewellMessage:"",isDefault:!1},this.$emit("update:whatsAppEdit",{}),this.$emit("update:modalWhatsapp",!1)},abrirModal(){this.whatsAppEdit.id&&(this.whatsapp={...this.whatsAppEdit})},async handleSaveWhatsApp(a){if(this.$v.whatsapp.$touch(),this.$v.whatsapp.$error)return this.$q.notify({type:"warning",progress:!0,position:"top",message:"Ops! Verifique os erros...",actions:[{icon:"close",round:!0,color:"white"}]});try{this.whatsAppEdit.id?await Object(o["g"])(this.whatsAppEdit.id,a):await Object(o["a"])(a),this.$q.notify({type:"positive",progress:!0,position:"top",message:`Whatsapp ${this.whatsAppEdit.id?"editado":"criado"} com sucesso!`,actions:[{icon:"close",round:!0,color:"white"}]}),this.fecharModal()}catch(t){console.error(t)}}},destroyed(){this.$v.whatsapp.$reset()}},E=O,N=e("0016"),I=e("05c0"),D=e("8f8e"),W=e("4b7e"),$=e("7f67"),L=Object(g["a"])(E,S,M,!1,null,"8889a1ae",null),T=L.exports;q()(L,"components",{QDialog:b["a"],QCard:f["a"],QCardSection:w["a"],QIcon:N["a"],QBtn:v["a"],QTooltip:I["a"],QCheckbox:D["a"],QCardActions:W["a"]}),q()(L,"directives",{ClosePopup:$["a"]});var j=e("8039"),P=e("5279"),R=e.n(P),F=e("8982");function B(a){return Object(F["a"])({url:"/fb/register-pages",method:"post",data:a})}function U(a){return Object(F["a"])({url:"/fb/logout-pages",method:"post",data:a})}const z=JSON.parse(localStorage.getItem("usuario"));var H={name:"IndexSessoesWhatsapp",components:{ModalQrCode:_,ModalWhatsapp:T,ItemStatusChannel:j["a"],VFacebookLogin:R.a},data(){return{loading:!1,userLogado:z,isAdmin:!1,abrirModalQR:!1,modalWhatsapp:!1,whatsappSelecionado:{},whatsAppId:null,objStatus:{qrcode:""},columns:[{name:"name",label:"Nome",field:"name",align:"left"},{name:"status",label:"Status",field:"status",align:"center"},{name:"session",label:"Sessão",field:"status",align:"center"},{name:"number",label:"Número",field:"number",align:"center"},{name:"updatedAt",label:"Última Atualização",field:"updatedAt",align:"center",format:a=>this.formatarData(a,"dd/MM/yyyy HH:mm")},{name:"isDefault",label:"Padrão",field:"isDefault",align:"center"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}],FB:{},FBscope:{},FBLoginOptions:{scope:"pages_manage_metadata,pages_messaging,instagram_basic,pages_show_list,pages_read_engagement,instagram_manage_messages"},FBPageList:[],fbSelectedPage:{name:null,id:null},fbPageName:"",fbUserToken:""}},computed:{...Object(Q["b"])(["whatsapps"]),cFbAppId(){return"841002356996100"},cDadosWhatsappSelecionado(){const{id:a}=this.whatsappSelecionado;return this.whatsapps.find((t=>t.id===a))}},methods:{formatarData(a,t){return Object(n["a"])(Object(l["a"])(a),t,{locale:d.a})},handleSdkInit({FB:a}){this.FB=a},async fbLogout(a){console.info("fbLogout"),await U(a)},fbLogin(a,t){"connected"===(null===a||void 0===a?void 0:a.status)?(this.fbFetchPages(a.authResponse.accessToken,a.authResponse.userID,t),console.info("fbLogin in connected")):"not_authorized"===(null===a||void 0===a?void 0:a.status)?console.info("fbLogin in not_authorized"):console.info("fbLogin in not logged")},async fbFetchPages(a,t,e){try{const s=await B({whatsapp:e,userToken:a,accountId:t}),{data:{data:i}}=s;this.FBPageList=i.page_details,this.fbUserToken=i.user_access_token}catch(s){}},handleOpenQrModal(a){this.whatsappSelecionado=a,this.abrirModalQR=!0},handleOpenModalWhatsapp(a){this.whatsappSelecionado=a,this.modalWhatsapp=!0},async handleDisconectWhatsSession(a){this.$q.dialog({title:"Atenção!! Deseja realmente desconectar? ",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["c"])(a).then((()=>{const t=this.whatsapps.find((t=>t.id===a));this.$store.commit("UPDATE_WHATSAPPS",{...t,status:"DISCONNECTED"})})).finally((a=>{this.loading=!1}))}))},async handleStartWhatsAppSession(a){try{await Object(o["f"])(a)}catch(t){console.error(t)}},async handleRequestNewQrCode(a,t){"telegram"!==a.type||a.tokenTelegram||this.$notificarErro("Necessário informar o token para Telegram"),this.loading=!0;try{await Object(o["e"])({id:a.id,isQrcode:!0}),setTimeout((()=>{this.handleOpenQrModal(a)}),2e3)}catch(e){console.error(e)}this.loading=!1},async listarWhatsapps(){const{data:a}=await Object(o["d"])();this.$store.commit("LOAD_WHATSAPPS",a)},async deleteWhatsapp(a){this.$q.dialog({title:"Atenção!! Deseja realmente deletar? ",message:"Não é uma boa ideia apagar se já tiver gerado atendimentos para esse whatsapp.",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(o["b"])(a.id).then((t=>{this.$store.commit("DELETE_WHATSAPPS",a.id)})).finally((a=>{this.loading=!1}))}))}},mounted(){this.isAdmin=localStorage.getItem("profile"),this.listarWhatsapps()}},V=H,G=e("eb85"),K=e("66e5"),J=e("4074"),X=e("cb32"),Y=e("0170"),Z=e("9569"),aa=e("74f7"),ta=e("cf57"),ea=Object(g["a"])(V,s,i,!1,null,"639ed869",null);t["default"]=ea.exports;q()(ea,"components",{QCard:f["a"],QCardSection:w["a"],QSeparator:G["a"],QItem:K["a"],QItemSection:J["a"],QAvatar:X["a"],QIcon:N["a"],QItemLabel:Y["a"],QBtn:v["a"],QCardActions:W["a"],QSpinnerRadio:Z["a"],QInnerLoading:aa["a"],QSpinnerGears:ta["a"]})}}]);