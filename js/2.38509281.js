(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"30d7":function(t,a,o){},"52dc":function(t,a,o){"use strict";o("30d7")},e090:function(t,a,o){"use strict";o.r(a);o("14d9");var e=function(){var t=this,a=t._self._c;return a("div",[a("q-table",{staticClass:"my-sticky-dynamic",class:{"q-ma-lg":!t.isChatContact,"q-ml-md heightChat":t.isChatContact},attrs:{title:"Contatos",id:"tabela-contatos-"+(t.isChatContact?"atendimento":""),data:t.contacts,columns:t.columns,loading:t.loading,"row-key":"id","virtual-scroll":"","virtual-scroll-item-size":48,"virtual-scroll-sticky-size-start":48,pagination:t.pagination,"rows-per-page-options":[0],bordered:t.isChatContact,square:t.isChatContact,flat:t.isChatContact,separator:t.isChatContact?"vertical":"horizontal"},on:{"update:pagination":function(a){t.pagination=a},"virtual-scroll":t.onScroll},scopedSlots:t._u([{key:"top",fn:function(){return[a("div",{staticClass:"row col-2 q-table__title items-center"},[t.isChatContact?a("q-btn",{staticClass:"q-mr-sm",attrs:{color:"black",round:"",flat:"",icon:"mdi-close"},on:{click:function(a){return t.$router.push({name:"chat-empty"})}}}):t._e(),t._v("\n        Contatos\n      ")],1),a("q-space"),a("q-input",{class:{"order-last q-mt-md":t.$q.screen.width<500},staticStyle:{width:"300px"},attrs:{filled:"",dense:"",debounce:"500",clearable:"",placeholder:"Localize"},on:{input:t.filtrarContato},scopedSlots:t._u([{key:"prepend",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(a){t.filter=a},expression:"filter"}}),a("q-btn",{staticClass:"q-ml-md",attrs:{color:"primary",label:"Adicionar"},on:{click:function(a){t.selectedContactId=null,t.modalContato=!0}}})]},proxy:!0},{key:"body-cell-profilePicUrl",fn:function(o){return[a("q-td",[a("q-avatar",{staticStyle:{border:"1px solid #9e9e9ea1 !important"}},[o.value?t._e():a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}}),a("q-img",{staticStyle:{"max-width":"150px"},attrs:{src:o.value},scopedSlots:t._u([{key:"error",fn:function(){return[a("q-icon",{attrs:{name:"mdi-account",size:"1.5em",color:"grey-5"}})]},proxy:!0}],null,!0)})],1)],1)]}},{key:"body-cell-acoes",fn:function(o){return[a("q-td",{staticClass:"text-center"},[o.row.number?a("q-btn",{attrs:{flat:"",round:"",icon:"img:whatsapp-logo.png"},on:{click:function(a){return t.handleSaveTicket(o.row,"whatsapp")}}}):t._e(),o.row.instagramPK?a("q-btn",{attrs:{flat:"",round:"",icon:"img:instagram-logo.png"},on:{click:function(a){return t.handleSaveTicket(o.row,"instagram")}}}):t._e(),o.row.telegramId?a("q-btn",{attrs:{flat:"",round:"",icon:"img:telegram-logo.png"},on:{click:function(a){return t.handleSaveTicket(o.row,"telegram")}}}):t._e(),a("q-btn",{attrs:{flat:"",round:"",icon:"edit"},on:{click:function(a){return t.editContact(o.row.id)}}}),a("q-btn",{attrs:{flat:"",round:"",icon:"mdi-delete"},on:{click:function(a){return t.deleteContact(o.row.id)}}})],1)]}},{key:"pagination",fn:function({pagination:a}){return[t._v("\n      "+t._s(t.contacts.length)+"/"+t._s(a.rowsNumber)+"\n    ")]}}])}),a("ContatoModal",{attrs:{contactId:t.selectedContactId,modalContato:t.modalContato},on:{"update:modalContato":function(a){t.modalContato=a},"update:modal-contato":function(a){t.modalContato=a},"contatoModal:contato-editado":t.UPDATE_CONTACTS,"contatoModal:contato-criado":t.UPDATE_CONTACTS}})],1)},n=[],i=(o("3c65"),o("c5bd")),s=o("73ad"),r=o("006a");const c=+localStorage.getItem("userId");var l={name:"IndexContatos",components:{ContatoModal:r["a"]},props:{isChatContact:{type:Boolean,default:!1}},data(){return{contacts:[],modalContato:!1,filter:null,selectedContactId:null,params:{pageNumber:1,searchParam:null,hasMore:!0},pagination:{rowsPerPage:40,rowsNumber:0,lastIndex:0},loading:!1,columns:[{name:"profilePicUrl",label:"",field:"profilePicUrl",style:"width: 50px",align:"center"},{name:"name",label:"Nome",field:"name",align:"left",style:"width: 300px",format:(t,a)=>a.number&&a.name==a.number&&a.pushname?a.pushname:a.name},{name:"number",label:"WhatsApp",field:"number",align:"center",style:"width: 300px"},{name:"instagramPK",label:"Instagram",field:"instagramPK",align:"center",style:"width: 300px",format:(t,a)=>a.instagramPK?a.pushname:""},{name:"telegramId",label:"Id Telegram",field:"telegramId",align:"center",style:"width: 300px",format:(t,a)=>a.telegramId?a.pushname:""},{name:"email",label:"Email",field:"email",style:"width: 500px",align:"left"},{name:"acoes",label:"Ações",field:"acoes",align:"center"}]}},methods:{LOAD_CONTACTS(t){const a=[];t.forEach((t=>{const o=this.contacts.findIndex((a=>a.id===t.id));-1!==o?this.contacts[o]=t:a.push(t)}));const o=[...this.contacts,...a];this.contacts=o},UPDATE_CONTACTS(t){const a=[...this.contacts],o=a.findIndex((a=>a.id===t.id));-1!==o?a[o]=t:a.unshift(t),this.contacts=[...a]},DELETE_CONTACT(t){const a=[...this.contacts],o=a.findIndex((a=>a.id===t));-1!==o&&a.splice(o,1),this.contacts=[...a]},filtrarContato(t){this.contacts=[],this.params.pageNumber=1,this.params.searchParam=t,this.loading=!0,this.listarContatos()},async listarContatos(){this.loading=!0;const{data:t}=await Object(s["f"])(this.params);this.params.hasMore=t.hasMore,this.LOAD_CONTACTS(t.contacts),this.loading=!1,this.pagination.lastIndex=this.contacts.length-1,this.pagination.rowsNumber=t.count},onScroll({to:t,ref:a,...o}){!0!==this.loading&&!0===this.params.hasMore&&t===this.pagination.lastIndex&&(this.loading=!0,this.params.pageNumber++,this.listarContatos())},async handleSaveTicket(t,a){if(t.id){this.loading=!0;try{const{data:o}=await Object(i["f"])({contactId:t.id,isActiveDemand:!0,userId:c,channel:a,status:"open"});await this.$store.commit("SET_HAS_MORE",!0),await this.$store.dispatch("AbrirChatMensagens",o),this.$q.notify({message:`Atendimento Iniciado || ${o.contact.name} - Ticket: ${o.id}`,type:"positive",position:"top",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.$router.push({name:"atendimento"})}catch(o){if(409===o.status){const a=JSON.parse(o.data.error);return void this.abrirAtendimentoExistente(t,a)}this.$notificarErro("Ocorreu um erro!",o)}this.loading=!1}},editContact(t){this.selectedContactId=t,this.modalContato=!0},deleteContact(t){this.$q.dialog({title:"Atenção!! Deseja realmente deletar o contato? ",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((()=>{this.loading=!0,Object(s["b"])(t).then((a=>{this.DELETE_CONTACT(t),this.$q.notify({type:"positive",progress:!0,position:"top",message:"Contato deletado!",actions:[{icon:"close",round:!0,color:"white"}]})})).catch((t=>{console.error(t),this.$notificarErro("Não é possível deletar o contato",t)})),this.loading=!1}))},abrirChatContato(t){this.$q.screen.lt.md&&"pending"!==t.status&&this.$root.$emit("infor-cabecalo-chat:acao-menu"),"pending"===t.status||t.id===this.$store.getters.ticketFocado.id&&"chat"===this.$route.name||(this.$store.commit("SET_HAS_MORE",!0),this.$store.dispatch("AbrirChatMensagens",t))},abrirAtendimentoExistente(t,a){this.$q.dialog({title:"Atenção!!",message:`${t.name} possui um atendimento em curso (Atendimento: ${a.id}). Deseja abrir o atendimento?`,cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"negative",push:!0},persistent:!0}).onOk((async()=>{try{this.abrirChatContato(a)}catch(t){this.$notificarErro("Não foi possível atualizar o token",t)}}))},confirmarSincronizarContatos(){this.$q.dialog({title:"Atenção!! Deseja realmente sincronizar os contatos? ",message:"Todas os contatos com os quais você já conversou pelo Whatsapp serão criados. Isso pode demorar um pouco...",cancel:{label:"Não",color:"primary",push:!0},ok:{label:"Sim",color:"warning",push:!0},persistent:!0}).onOk((async()=>{this.loading=!0,await this.sincronizarContatos(),this.loading=!1}))},async sincronizarContatos(){try{this.loading=!0,await Object(s["h"])(),this.$q.notify({type:"info",progress:!0,position:"top",textColor:"black",message:"Contatos estão sendo atualizados. Isso pode levar um tempo...",actions:[{icon:"close",round:!0,color:"white"}]})}catch(t){console.error(t),this.$notificarErro("Ocorreu um erro ao sincronizar os contatos",t),this.loading=!0}this.loading=!0}},mounted(){this.listarContatos()}},d=l,m=(o("52dc"),o("2877")),h=o("eaac"),u=o("9c40"),p=o("2c91"),g=o("27f9"),f=o("0016"),C=o("db86"),b=o("cb32"),y=o("068f"),w=o("eebe"),k=o.n(w),q=Object(m["a"])(d,e,n,!1,null,null,null);a["default"]=q.exports;k()(q,"components",{QTable:h["a"],QBtn:u["a"],QSpace:p["a"],QInput:g["a"],QIcon:f["a"],QTd:C["a"],QAvatar:b["a"],QImg:y["a"]})}}]);