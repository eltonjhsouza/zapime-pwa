(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"1d5c":function(e,t,a){},"34e6":function(e,t,a){"use strict";a("60ff")},"60ff":function(e,t,a){},"923d":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bg-white no-scroll hide-scrollbar overflow-hidden"},[t("InforCabecalhoChat",{on:{"updateTicket:resolver":function(t){return e.atualizarStatusTicket("closed")},"updateTicket:retornar":function(t){return e.atualizarStatusTicket("pending")},"abrir:modalAgendamentoMensagem":function(t){e.modalAgendamentoMensagem=!0}}}),t("q-scroll-area",{ref:"scrollContainer",staticClass:"scroll-y",style:e.cStyleScroll,on:{scroll:e.scrollArea}},[t("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[e.cMessages.length?t("infinite-loading",{attrs:{direction:"top",identificador:e.ticketFocado.id,spinner:"spiral"},on:{infinite:e.onLoadMore}},[t("div",{attrs:{slot:"no-results"},slot:"no-results"},[e.cMessages.length?e._e():t("div",[e._v("\n            Sem resultados :(\n          ")])]),t("div",{attrs:{slot:"no-more"},slot:"no-more"},[e._v("\n          Nada mais a carregar :)\n        ")])]):e._e()],1),e.cMessages.length&&e.ticketFocado.id?t("MensagemChat",{attrs:{replyingMessage:e.replyingMessage,mensagens:e.cMessages,ativarMultiEncaminhamento:e.ativarMultiEncaminhamento,mensagensParaEncaminhar:e.mensagensParaEncaminhar},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t},"mensagem-chat:encaminhar-mensagem":e.abrirModalEncaminharMensagem,"update:ativarMultiEncaminhamento":function(t){e.ativarMultiEncaminhamento=t},"update:ativar-multi-encaminhamento":function(t){e.ativarMultiEncaminhamento=t},"update:mensagensParaEncaminhar":function(t){e.mensagensParaEncaminhar=t},"update:mensagens-para-encaminhar":function(t){e.mensagensParaEncaminhar=t}}}):e._e(),t("div",{attrs:{id:"inicioListaMensagensChat"}})],1),e.ticketFocado.id?e._e():t("div",{staticClass:"absolute-center items-center",class:{"row col text-center q-col-gutter-lg":!e.$q.screen.xs,"full-width text-center":e.$q.screen.xs}},[t("q-icon",{staticClass:"row col text-center",class:{"row col text-center q-mr-lg":!e.$q.screen.xs,"full-width text-center center-block":e.$q.screen.xs},staticStyle:{"margin-left":"30vw"},attrs:{size:"6em",color:"grey-6",name:"mdi-emoticon-wink-outline"}}),t("h1",{staticClass:"text-grey-6 row col justify-center",class:{"full-width":e.$q.screen.xs}},[e._v("\n      Selecione um ticket!\n    ")])],1),e.cMessages.length?t("div",{staticClass:"relative-position"},[t("transition",{attrs:{appear:"","enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[e.scrollIcon?t("div",[t("q-btn",{staticClass:"vac-icon-scroll",attrs:{color:"white","text-color":"black",icon:"mdi-arrow-down",round:"",push:"",ripple:"",dense:""},on:{click:e.scrollToBottom}})],1):e._e()])],1):e._e(),t("q-footer",{staticClass:"bg-white"},[t("q-separator",{staticClass:"bg-grey-4"}),e.replyingMessage?t("q-list",{staticClass:"q-pa-none q-py-md text-black row items-center col justify-center full-width",class:{"bg-grey-1":!e.$q.dark.isActive,"bg-grey-10":e.$q.dark.isActive},staticStyle:{"max-height":"100px"},style:"border-top: 1px solid #; max-height: 140px; width: 100%;"},[t("q-item",{staticClass:"q-card--bordered q-pb-sm btn-rounded",class:{"bg-blue-1":!e.replyingMessage.fromMe&&!e.$q.dark.isActive,"bg-blue-2 text-black":!e.replyingMessage.fromMe&&e.$q.dark.isActive,"bg-grey-2 text-black":e.replyingMessage.fromMe},style:"\n          width: 460px;\n          min-width: 460px;\n          max-width: 460px;\n          max-height: 110px;\n        "},[t("q-item-section",[e.replyingMessage.fromMe?e._e():t("q-item-label",{class:{"text-black":e.$q.dark.isActive},attrs:{caption:""}},[e._v("\n            "+e._s(e.replyingMessage.contact&&e.replyingMessage.contact.name)+"\n          ")]),t("q-item-label",{attrs:{lines:"4"},domProps:{innerHTML:e._s(e.farmatarMensagemWhatsapp(e.replyingMessage.body))}})],1),t("q-btn",{staticClass:"float-right absolute-top-right",attrs:{dense:"",flat:"",round:"",icon:"close",disabled:e.loading||"open"!==e.ticketFocado.status},on:{click:function(t){e.replyingMessage=null}}})],1)],1):e._e(),e.mensagensParaEncaminhar.length>0?t("q-banner",{staticClass:"text-grey-8",scopedSlots:e._u([{key:"action",fn:function(){return[t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"negative",label:"Cancelar"},on:{click:e.cancelarMultiEncaminhamento}}),t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"positive",label:"Enviar",icon:"mdi-send"},on:{click:function(t){return e.confirmarEncaminhamentoMensagem(e.mensagensParaEncaminhar)}}})]},proxy:!0}],null,!1,1463545920)},[t("span",{staticClass:"text-bold text-h5"},[e._v(" "+e._s(e.mensagensParaEncaminhar.length)+" de 10 mensagens")]),e._v(" selecionadas para\n      serem encaminhadas.\n      "),t("q-separator",{staticClass:"bg-grey-4"}),t("q-select",{ref:"selectAutoCompleteContato",staticClass:"q-my-md",attrs:{dense:"",autofocus:"",outlined:"",rounded:"","hide-dropdown-icon":"",loading:e.loading,options:e.contatos,"input-debounce":"700","use-input":"","hide-selected":"","fill-input":"",clearable:"","option-label":"name","option-value":"id",label:"Localize e selecione o contato",hint:"Digite no mínimo duas letras para localizar o contato. É possível selecionar apenas 1 contato!"},on:{filter:e.localizarContato},scopedSlots:e._u([{key:"option",fn:function(a){return[a.opt.name?t("q-item",e._g(e._b({},"q-item",a.itemProps,!1),a.itemEvents),[t("q-item-section",[t("q-item-label",[e._v(" "+e._s(a.opt.name))]),t("q-item-label",{attrs:{caption:""}},[e._v(e._s(a.opt.number))])],1)],1):e._e()]}}],null,!1,1212698310),model:{value:e.contatoSelecionado,callback:function(t){e.contatoSelecionado=t},expression:"contatoSelecionado"}})],1):e._e(),e.mensagensParaEncaminhar.length?e._e():t("InputMensagem",{attrs:{mensagensRapidas:e.mensagensRapidas,replyingMessage:e.replyingMessage},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t}}}),t("q-resize-observer",{on:{resize:e.onResizeInputMensagem}})],1),t("q-dialog",{attrs:{persistent:""},model:{value:e.modalAgendamentoMensagem,callback:function(t){e.modalAgendamentoMensagem=t},expression:"modalAgendamentoMensagem"}},[t("q-card",{style:e.$q.screen.width<770?"min-width: 98vw; max-width: 98vw":"min-width: 50vw; max-width: 50vw"},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("\n          Agendamento de Mensagem\n          "),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-padrao btn-rounded float-right",attrs:{flat:"",color:"negative",icon:"close"}})],1)]),t("q-card-section",{staticClass:"q-mb-lg"},[t("InputMensagem",{attrs:{isScheduleDate:"",mensagensRapidas:e.mensagensRapidas,replyingMessage:e.replyingMessage},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t}}})],1)],1)],1),t("q-dialog",{attrs:{persistent:""},on:{hide:function(t){e.mensagemEncaminhamento={}}},model:{value:e.modalEncaminhamentoMensagem,callback:function(t){e.modalEncaminhamentoMensagem=t},expression:"modalEncaminhamentoMensagem"}},[t("q-card",{style:e.$q.screen.width<770?"min-width: 98vw; max-width: 98vw":"min-width: 50vw; max-width: 50vw"},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("\n          Encaminhando Mensagem\n          "),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"bg-padrao btn-rounded float-right",attrs:{flat:"",color:"negative",icon:"close"}})],1)]),t("q-separator",{attrs:{inset:""}}),t("q-card-section",[t("MensagemChat",{attrs:{isShowOptions:!1,replyingMessage:e.replyingMessage,mensagens:[e.mensagemEncaminhamento]},on:{"update:replyingMessage":function(t){e.replyingMessage=t},"update:replying-message":function(t){e.replyingMessage=t}}})],1),t("q-card-section",[t("q-select",{ref:"selectAutoCompleteContato",staticClass:"q-px-lg",attrs:{autofocus:"",outlined:"",rounded:"","hide-dropdown-icon":"",loading:e.loading,options:e.contatos,"input-debounce":"700","use-input":"","hide-selected":"","fill-input":"",clearable:"","option-label":"name","option-value":"id",label:"Localize e selecione o contato",hint:"Digite no mínimo duas letras para localizar o contato. É possível selecionar apenas 1 contato!"},on:{filter:e.localizarContato},scopedSlots:e._u([{key:"option",fn:function(a){return[a.opt.name?t("q-item",e._g(e._b({},"q-item",a.itemProps,!1),a.itemEvents),[t("q-item-section",[t("q-item-label",[e._v(" "+e._s(a.opt.name))]),t("q-item-label",{attrs:{caption:""}},[e._v(e._s(a.opt.number))])],1)],1):e._e()]}}]),model:{value:e.contatoSelecionado,callback:function(t){e.contatoSelecionado=t},expression:"contatoSelecionado"}})],1),t("q-card-actions",{staticClass:"q-pa-md",attrs:{align:"right"}},[t("q-btn",{staticClass:"bg-padrao q-px-sm",attrs:{flat:"",color:"positive",label:"Enviar",icon:"mdi-send"},on:{click:function(t){return e.confirmarEncaminhamentoMensagem([e.mensagemEncaminhamento])}}})],1)],1)],1)],1)},s=[],n=a("a700"),o=function(){var e=this,t=e._self._c;return t("div",[t("q-header",{staticClass:"bg-white text-grey-10 no-border-radius"},[t("q-toolbar",{staticClass:"no-border-radius q-pa-none",staticStyle:{"min-height":"60px",height:"60px"}},[e.$q.screen.lt.md?t("q-btn",{staticClass:"q-mx-xs-none q-ml-md",attrs:{flat:"",dense:"",round:"",icon:"mdi-menu",color:e.$q.dark.isActive?"white":""},on:{click:function(t){return e.$root.$emit("infor-cabecalo-chat:acao-menu")}}}):e._e(),t("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"q-ma-none q-pa-none full",staticStyle:{"min-height":"60px",height:"60px",width:"300px"},attrs:{clickable:""},on:{click:function(t){return e.$root.$emit("update-ticket:info-contato")}}},[t("q-item-section",{staticClass:"q-pl-sm",attrs:{avatar:""}},[t("q-btn",{attrs:{round:"",flat:""}},[t("q-avatar",{staticClass:"bg-grey"},[t("q-img",{attrs:{src:e.Value(e.cticket.contact,"profilePicUrl")}})],1)],1)],1),t("q-item-section",{attrs:{id:"InfoCabecalhoChat"}},[t("q-item-label",{staticClass:"text-bold"},[e._v("\n            "+e._s(e.Value(e.cticket.contact,"name"))+"\n            "),e.Value(e.cticket.contact,"name")?e._e():t("q-skeleton",{staticStyle:{width:"230px"},attrs:{animation:"none"}})],1),t("q-item-label",{staticStyle:{"margin-top":"2px !important"},style:e.$q.screen.width<500?"max-width: 170px":"",attrs:{caption:"",lines:"1"}},[e.Value(e.cticket.user,"name")?t("span",[e._v(" Atribuido à: "+e._s(e.Value(e.cticket.user,"name"))+" ")]):t("q-skeleton",{staticClass:"text-caption",staticStyle:{width:"150px"},attrs:{type:"text",animation:"none"}})],1),t("q-item-label",{staticStyle:{"margin-top":"0px !important"},attrs:{lines:"1"}},[e.Value(e.cticket.contact,"name")?t("span",{staticStyle:{"font-size":"11px"}},[e._v(" Ticket: "+e._s(e.cticket.id))]):e._e()])],1)],1),t("q-space"),e.Value(e.cticket.contact,"name")?t("div",{staticClass:"q-gutter-xs q-pr-sm"},[e.$q.screen.xs?[t("q-fab",{staticClass:"bg-padrao text-bold",class:{"bg-black":e.$q.dark.isActive},attrs:{disable:"closed"==e.cticket.status,color:"primary",flat:"",dense:"",icon:"keyboard_arrow_left",direction:"down",padding:"5px",label:"Ações"}},[t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{color:"positive",flat:"",icon:"mdi-comment-check"},on:{click:function(t){return e.$emit("updateTicket:resolver")}}},[t("q-tooltip",{attrs:{"content-class":"bg-positive text-bold"}},[e._v("\n                Resolver\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{flat:"",icon:"mdi-replay",color:"negative"},on:{click:function(t){return e.$emit("updateTicket:retornar")}}},[t("q-tooltip",{attrs:{"content-class":"bg-negative text-bold"}},[e._v("\n                Retornar Ticket para a Fila\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black-dark":e.$q.dark.isActive},attrs:{flat:"",color:"primary"},on:{click:e.listarUsuarios}},[t("q-icon",{attrs:{name:"mdi-transfer"}}),t("q-tooltip",{attrs:{"content-class":"bg-primary text-bold"}},[e._v("\n                Transferir\n              ")])],1),t("q-fab-action",{staticClass:"bg-padrao q-pa-xs",class:{"bg-black":e.$q.dark.isActive},attrs:{flat:"",color:"amber-9"},on:{click:function(t){return e.$emit("abrir:modalAgendamentoMensagem")}}},[t("q-icon",{attrs:{name:"mdi-message-text-clock-outline"}}),t("q-tooltip",{attrs:{"content-class":"bg-grey-9 text-bold"}},[e._v("\n                Agendamento de mensagem\n              ")])],1)],1)]:[t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{flat:"",icon:"mdi-message-text-clock-outline",color:"amber-9",disable:"closed"==e.cticket.status},on:{click:function(t){return e.$emit("abrir:modalAgendamentoMensagem")}}},[t("q-tooltip",{attrs:{"content-class":"bg-grey-9 text-bold"}},[e._v("\n              Agendamento de mensagem\n            ")])],1),t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{flat:"",icon:"mdi-replay",color:"negative",disable:"closed"==e.cticket.status},on:{click:function(t){return e.$emit("updateTicket:retornar")}}},[t("q-tooltip",{attrs:{"content-class":"bg-negative text-bold"}},[e._v("\n              Retornar Ticket para a Fila\n            ")])],1),t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{color:"positive",flat:"",icon:"mdi-comment-check",disable:"closed"==e.cticket.status},on:{click:function(t){return e.$emit("updateTicket:resolver")}}},[t("q-tooltip",{attrs:{"content-class":"bg-positive text-bold"}},[e._v("\n              Resolver\n            ")])],1),t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{flat:"",color:"primary",disable:"closed"==e.cticket.status},on:{click:e.listarUsuarios}},[t("q-icon",{attrs:{name:"mdi-transfer"}}),t("q-tooltip",{attrs:{"content-class":"bg-primary text-bold"}},[e._v("\n              Transferir\n            ")])],1)]],2):e._e()],1),t("q-separator")],1),t("q-dialog",{attrs:{persistent:""},on:{hide:function(t){e.modalTransferirTicket=!1}},model:{value:e.modalTransferirTicket,callback:function(t){e.modalTransferirTicket=t},expression:"modalTransferirTicket"}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{width:"500px"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v("Selecione o destino:")])]),t("q-card-section",[t("q-select",{attrs:{square:"",outlined:"",options:e.usuarios,"emit-value":"","map-options":"","option-value":"id","option-label":"name",label:"Usuário destino"},model:{value:e.usuarioSelecionado,callback:function(t){e.usuarioSelecionado=t},expression:"usuarioSelecionado"}})],1),t("q-card-actions",{attrs:{align:"right"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-lg",attrs:{flat:"",label:"Sair",color:"negative"}}),t("q-btn",{attrs:{flat:"",label:"Salvar",color:"primary"},on:{click:e.confirmarTransferenciaTicket}})],1)],1)],1)],1)},r=[],c=(a("caad"),a("2f62")),l=a("9a1b"),d=a("c5bd");const m=+localStorage.getItem("userId");var u={name:"InfoCabecalhoMensagens",data(){return{modalTransferirTicket:!1,usuarioSelecionado:null,usuarios:[]}},computed:{...Object(c["b"])(["ticketFocado"]),cticket(){const e={contact:{profilePicUrl:"",name:""},user:{name:""}};return Object.keys(this.ticketFocado).includes("contact")?this.ticketFocado:e}},methods:{Value(e,t){try{return e[t]}catch(a){return""}},async listarUsuarios(){try{const{data:e}=await Object(l["c"])();this.usuarios=e.users,this.modalTransferirTicket=!0}catch(e){console.error(e),this.$notificarErro("Problema ao carregar usuários",e)}},async confirmarTransferenciaTicket(){this.usuarioSelecionado&&(this.ticketFocado.userId!==this.usuarioSelecionado?this.ticketFocado.userId!==m||m!==this.usuarioSelecionado?(await Object(d["b"])(this.ticketFocado.id,{userId:this.usuarioSelecionado,status:"open",isTransference:1}),this.$q.notify({type:"positive",message:"Ticket transferido.",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}),this.modalTransferirTicket=!1,this.$store.commit("TICKET_FOCADO",{})):this.$q.notify({type:"info",message:"Ticket já pertece ao seu usuário",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}):this.$q.notify({type:"info",message:"Ticket já pertece ao usuário selecionado.",progress:!0,actions:[{icon:"close",round:!0,color:"white"}]}))}}},p=u,h=(a("34e6"),a("2877")),g=a("e359"),v=a("65c6"),b=a("9c40"),f=a("66e5"),q=a("4074"),x=a("cb32"),k=a("068f"),y=a("0170"),w=a("293e"),M=a("2c91"),C=a("05c0"),_=a("0016"),E=a("c294"),S=a("72db"),A=a("4e73"),$=a("1c1c"),I=a("eb85"),T=a("24e8"),P=a("f09f"),R=a("a370"),Q=a("ddd8"),D=a("4b7e"),F=a("714f"),j=a("7f67"),O=a("eebe"),z=a.n(O),L=Object(h["a"])(p,o,r,!1,null,"d9026690",null),B=L.exports;z()(L,"components",{QHeader:g["a"],QToolbar:v["a"],QBtn:b["a"],QItem:f["a"],QItemSection:q["a"],QAvatar:x["a"],QImg:k["a"],QItemLabel:y["a"],QSkeleton:w["a"],QSpace:M["a"],QTooltip:C["a"],QIcon:_["a"],QFab:E["a"],QFabAction:S["a"],QMenu:A["a"],QList:$["a"],QSeparator:I["a"],QDialog:T["a"],QCard:P["a"],QCardSection:R["a"],QSelect:Q["a"],QCardActions:D["a"]}),z()(L,"directives",{Ripple:F["a"],ClosePopup:j["a"]});var N=a("ef42"),U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row q-pb-md q-pt-sm bg-white justify-start items-center text-grey-9 relative-position",staticStyle:{"min-height":"80px"}},[e.isScheduleDate?t("div",{staticClass:"row col-12 q-pa-sm"},[t("q-datetime-picker",{staticStyle:{width:"300px"},attrs:{dense:"",rounded:"","hide-bottom-space":"",outlined:"","stack-label":"","bottom-slots":"",label:"Data/Hora Agendamento",mode:"datetime",color:"primary",format24h:""},model:{value:e.scheduleDate,callback:function(t){e.scheduleDate=t},expression:"scheduleDate"}})],1):e._e(),t("div",{staticClass:"full-width relative-position"},[t("div",{staticClass:"full-width absolute-top"},[t("q-menu",{key:e.cMensagensRapidas.length,staticClass:"no-box-shadow no-shadow",attrs:{"max-width":"600px",square:"","no-focus":"",fit:"",persistent:"","max-height":"200px",offset:[0,-45],value:e.textChat.startsWith("/")||e.visualizarMensagensRapidas},on:{hide:function(t){e.visualizarMensagensRapidas=!1}}},[e.cMensagensRapidas.length?t("q-list",{staticClass:"no-shadow no-box-shadow",staticStyle:{"min-width":"100px"},attrs:{separator:""}},e._l(e.cMensagensRapidas,(function(a){return t("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:a.key,attrs:{clickable:""},on:{click:function(t){return e.mensagemRapidaSelecionada(a.message)}}},[t("q-item-section",[t("q-item-label",{staticClass:"text-bold"},[e._v(" "+e._s(a.key)+" ")]),t("q-item-label",{attrs:{caption:"",lines:"2"}},[e._v(" "+e._s(a.message)+" ")])],1),t("q-tooltip",{attrs:{"content-class":"bg-padrao text-grey-9 text-bold"}},[e._v("\n              "+e._s(a.message)+"\n            ")])],1)})),1):t("q-list",{staticClass:"no-shadow no-box-shadow",staticStyle:{"min-width":"100px"},attrs:{separator:""}},[t("q-item",[t("q-item-section",[t("q-item-label",{staticClass:"text-negative text-bold"},[e._v("Ops... Nada por aqui!")]),t("q-item-label",{attrs:{caption:""}},[e._v("Cadastre suas mensagens na administração de sistema.")])],1)],1)],1)],1)],1)]),e.isRecordingAudio?[t("div",{staticClass:"full-width items-center row justify-end"},[t("q-skeleton",{staticClass:"col-grow q-mx-md",attrs:{animation:"pulse-y",type:"text"}}),e.isRecordingAudio?t("div",{staticClass:"flex flex-center items-center",staticStyle:{width:"200px"}},[t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-close",color:"negative"},on:{click:e.handleCancelRecordingAudio}}),t("RecordingTimer",{staticClass:"text-bold",class:{"text-white":e.$q.dark.isActive}}),t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-send-circle-outline",color:"positive"},on:{click:e.handleStopRecordingAudio}})],1):e._e()],1)]:[e.$q.screen.width>500?t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-paperclip",disable:e.cDisableActions,color:e.$q.dark.isActive?"white":""},on:{click:e.abrirEnvioArquivo}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n        Enviar arquivo\n      ")])],1):e._e(),e.$q.screen.width>500?t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{flat:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions,color:e.$q.dark.isActive?"white":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n        Emoji\n      ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1):e._e(),t("q-checkbox",{staticClass:"q-mx-sm q-ml-md",attrs:{"keep-color":"",size:"xl",dense:"",color:e.sign?"positive":"black","checked-icon":"mdi-draw","unchecked-icon":"mdi-draw"},on:{input:e.handleSign},model:{value:e.sign,callback:function(t){e.sign=t},expression:"sign"}},[t("q-tooltip",[e._v("\n        "+e._s(e.sign?"Desativar":"Ativar")+" Assinatura\n      ")])],1),t("q-input",{directives:[{name:"show",rawName:"v-show",value:!e.cMostrarEnvioArquivo,expression:"!cMostrarEnvioArquivo"}],ref:"inputEnvioMensagem",staticClass:"col-grow q-mx-xs text-grey-10 inputEnvioMensagem",attrs:{"hide-bottom-space":"",loading:e.loading,disable:e.cDisableActions,id:"inputEnvioMensagem",type:"textarea","bg-color":"grey-2",color:"grey-7",placeholder:"Digita sua mensagem","input-style":"max-height: 30vh",autogrow:"",rounded:"",dense:"",outlined:"",value:e.textChat},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:(t.preventDefault(),(()=>e.textChat.trim().length?e.enviarMensagem():"").apply(null,arguments))},paste:e.handleInputPaste},scopedSlots:e._u([e.$q.screen.width<500?{key:"prepend",fn:function(){return[t("q-btn",{attrs:{flat:"",icon:"mdi-emoticon-happy-outline",disable:e.cDisableActions,dense:"",round:"",color:e.$q.dark.isActive?"white":""}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n            Emoji\n          ")]),t("q-menu",{attrs:{anchor:"top right",self:"bottom middle",offset:[5,40]}},[t("VEmojiPicker",{staticStyle:{width:"40vw"},attrs:{showSearch:!1,emojisByRow:20,labelSearch:"Localizar...",lang:"pt-BR"},on:{select:e.onInsertSelectEmoji}})],1)],1)]},proxy:!0}:null,{key:"append",fn:function(){return[e.$q.screen.width<500?t("q-btn",{staticClass:"bg-padrao btn-rounded",attrs:{flat:"",icon:"mdi-paperclip",disable:e.cDisableActions,dense:"",round:"",color:e.$q.dark.isActive?"white":""},on:{click:e.abrirEnvioArquivo}},[t("q-tooltip",{attrs:{"content-class":" text-bold"}},[e._v("\n            Enviar arquivo\n          ")])],1):e._e(),t("q-btn",{attrs:{dense:"",flat:"",round:"",icon:"mdi-message-flash-outline"},on:{click:function(t){e.visualizarMensagensRapidas=!e.visualizarMensagensRapidas}}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n            Mensagens Rápidas\n          ")])],1)]},proxy:!0}],null,!0),model:{value:e.textChat,callback:function(t){e.textChat=t},expression:"textChat"}}),t("q-file",{directives:[{name:"show",rawName:"v-show",value:e.cMostrarEnvioArquivo,expression:"cMostrarEnvioArquivo"}],ref:"PickerFileMessage",staticClass:"col-grow q-mx-xs PickerFileMessage",attrs:{loading:e.loading,disable:e.cDisableActions,id:"PickerFileMessage","bg-color":"blue-grey-1","input-style":"max-height: 30vh",outlined:"","use-chips":"",multiple:"",autogrow:"",dense:"",rounded:"",append:"","max-files":5,"max-file-size":5485760,"max-total-size":5485760,accept:".jpg, .png, image/jpeg, .pdf, .doc, .docx, .mp4, .xls, .xlsx, .jpeg, .zip, .ppt, .pptx, image/*"},on:{rejected:e.onRejectedFiles},model:{value:e.arquivos,callback:function(t){e.arquivos=t},expression:"arquivos"}}),e.textChat||e.cMostrarEnvioArquivo?t("q-btn",{ref:"btnEnviarMensagem",staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{disabled:"open"!==e.ticketFocado.status,flat:"",icon:"mdi-send",color:e.$q.dark.isActive?"white":""},on:{click:e.enviarMensagem}},[t("q-tooltip",{attrs:{"content-class":" text-bold"}},[e._v("\n        Enviar Mensagem\n      ")])],1):e._e(),e.textChat||e.cMostrarEnvioArquivo||e.isRecordingAudio?e._e():t("q-btn",{staticClass:"bg-padrao btn-rounded q-mx-xs",attrs:{disabled:e.cDisableActions,flat:"",icon:"mdi-microphone",color:e.$q.dark.isActive?"white":""},on:{click:e.handleSartRecordingAudio}},[t("q-tooltip",{attrs:{"content-class":"text-bold"}},[e._v("\n        Enviar Áudio\n      ")])],1)],t("q-dialog",{attrs:{position:"right"},on:{hide:e.hideModalPreviewImagem,show:e.showModalPreviewImagem},model:{value:e.abrirModalPreviewImagem,callback:function(t){e.abrirModalPreviewImagem=t},expression:"abrirModalPreviewImagem"}},[t("q-card",{staticClass:"q-pa-md",staticStyle:{height:"90vh","min-width":"60vw","max-width":"60vw"}},[t("q-card-section",[t("div",{staticClass:"text-h6"},[e._v(e._s(e.urlMediaPreview.title)+"\n          "),t("q-btn",{staticClass:"float-right",attrs:{icon:"close",color:"negative",round:"",outline:""},on:{click:e.hideModalPreviewImagem}})],1)]),t("q-card-section",[t("q-img",{staticClass:"img-responsive mdi-image-auto-adjust q-uploader__file--img",staticStyle:{height:"60vh","min-width":"55vw","max-width":"55vw"},attrs:{src:e.urlMediaPreview.src,"spinner-color":"white"}})],1),t("q-card-actions",{attrs:{align:"center"}},[t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],ref:"qbtnPasteEnvioMensagem",attrs:{label:"Enviar",color:"primary"},on:{click:e.enviarMensagem,keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")||t.ctrlKey||t.shiftKey||t.altKey||t.metaKey?null:e.enviarMensagem()}}})],1),t("span",{staticClass:"row col text-caption text-blue-grey-10"},[e._v("* Confirmar envio: Enter")]),t("span",{staticClass:"row col text-caption text-blue-grey-10"},[e._v("** Cancelar: ESC")])],1)],1)],2)},V=[],K=(a("5319"),a("2b3d"),a("9861"),a("d9e2"),a("18d6")),H=a("1732"),W=a("79b5"),Z=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"timerBox"},[t("span",[e._v(e._s(e.addZero(e.timer.minutes))+":"+e._s(e.addZero(e.timer.seconds)))])])])},J=[],G={name:"RecordingTimer",data(){return{timer:{minutes:0,seconds:0}}},methods:{interval(){setInterval((()=>{59===this.timer.seconds&&(this.timer={...this.timer,minutes:this.timer.minutes+1,seconds:0}),this.timer={...this.timer,seconds:this.timer.seconds+1}}),1e3)},stopInteval(){clearInterval(this.interval)},addZero(e){return e<10?"0"+e:e}},mounted(){this.interval()},destroyed(){this.stopInteval()}},X=G,Y=(a("cd32"),Object(h["a"])(X,Z,J,!1,null,"3fda5757",null)),ee=Y.exports,te=a("9de0"),ae=a.n(te);const ie=new ae.a({bitRate:128});var se={name:"InputMensagem",mixins:[n["a"]],props:{replyingMessage:{type:Object,default:null},isScheduleDate:{type:Boolean,default:!1},mensagensRapidas:{type:Array,default:()=>[]}},components:{VEmojiPicker:W["a"],RecordingTimer:ee},data(){return{loading:!1,abrirFilePicker:!1,abrirModalPreviewImagem:!1,isRecordingAudio:!1,urlMediaPreview:{title:"",src:""},visualizarMensagensRapidas:!1,arquivos:[],textChat:"",sign:!0,scheduleDate:null}},computed:{...Object(c["b"])(["ticketFocado"]),cMostrarEnvioArquivo(){return this.arquivos.length>0},cDisableActions(){return this.isRecordingAudio||"open"!==this.ticketFocado.status},cMensagensRapidas(){var e;let t=null===(e=this.textChat)||void 0===e?void 0:e.toLowerCase();return t&&t.trim().startsWith("/")&&(t=t.replace("/","")),t?this.mensagensRapidas.filter((e=>-1!==e.key.toLowerCase().indexOf(t))):this.mensagensRapidas}},methods:{openFilePreview(e){const t=e.clipboardData.files[0],a=window.URL.createObjectURL(t);return a},handleInputPaste(e){var t,a,i;null!==(t=this.ticketFocado)&&void 0!==t&&t.id&&(e.clipboardData.files[0]&&(this.textChat="",this.arquivos=[e.clipboardData.files[0]],this.abrirModalPreviewImagem=!0,this.urlMediaPreview={title:`Enviar imagem para ${null===(a=this.ticketFocado)||void 0===a||null===(i=a.contact)||void 0===i?void 0:i.name}`,src:this.openFilePreview(e)},this.$refs.inputEnvioMensagem.focus()))},mensagemRapidaSelecionada(e){this.textChat=e,setTimeout((()=>{this.$refs.inputEnvioMensagem.focus()}),300)},onInsertSelectEmoji(e){const t=this;var a=this.$refs.inputEnvioMensagem.$refs.input,i=a.selectionStart,s=a.selectionEnd,n=i,o=a.value;e.data&&(t.txtContent=this.textChat,t.txtContent=o.substring(0,i)+e.data+o.substring(s,o.length),this.textChat=t.txtContent,setTimeout((()=>{a.selectionStart=a.selectionEnd=n+e.data.length}),10))},abrirEnvioArquivo(e){this.textChat="",this.abrirFilePicker=!0,this.$refs.PickerFileMessage.pickFiles(e)},async handleSartRecordingAudio(){try{await navigator.mediaDevices.getUserMedia({audio:!0}),await ie.start(),this.isRecordingAudio=!0}catch(e){this.isRecordingAudio=!1}},async handleStopRecordingAudio(){this.loading=!0;try{const[,e]=await ie.stop().getMp3();if(e.size<1e4)return this.loading=!1,void(this.isRecordingAudio=!1);const t=new FormData,a=`${(new Date).getTime()}.mp3`;t.append("medias",e,a),t.append("body",a),t.append("fromMe",!0),this.isScheduleDate&&t.append("scheduleDate",this.scheduleDate);const i=this.ticketFocado.id;await Object(d["i"])(i,t),this.arquivos=[],this.textChat="",this.$emit("update:replyingMessage",null),this.abrirFilePicker=!1,this.abrirModalPreviewImagem=!1,this.isRecordingAudio=!1,this.loading=!1,setTimeout((()=>{this.scrollToBottom()}),300)}catch(e){this.isRecordingAudio=!1,this.loading=!1,this.$notificarErro("Ocorreu um erro!",e)}},async handleCancelRecordingAudio(){try{await ie.stop().getMp3(),this.isRecordingAudio=!1,this.loading=!1}catch(e){this.$notificarErro("Ocorreu um erro!",e)}},prepararUploadMedia(){if(!this.arquivos.length)throw new Error("Não existem arquivos para envio");const e=new FormData;return e.append("fromMe",!0),this.arquivos.forEach((t=>{e.append("medias",t),e.append("body",t.name),e.append("idFront",Object(H["a"])()),this.isScheduleDate&&e.append("scheduleDate",this.scheduleDate)})),e},prepararMensagemTexto(){if(""===this.textChat.trim())throw new Error("Mensagem Inexistente");if(this.textChat.trim()&&this.textChat.trim().startsWith("/")){let e=this.textChat.trim().toLowerCase();e=e.replace("/","");const t=this.cMensagensRapidas.find((t=>t.key.toLowerCase()===e));if(null===t||void 0===t||!t.message){const e=this.cMensagensRapidas.length>1?"Várias mensagens rápidas encontradas. Selecione uma ou digite uma chave única da mensagem.":"/ indica que você deseja enviar uma mensagem rápida, mas nenhuma foi localizada. Cadastre ou apague a / e digite sua mensagem.";throw this.$notificarErro(e),this.loading=!1,new Error(e)}this.textChat=t.message}let e=this.textChat.trim();const t=localStorage.getItem("username");t&&this.sign&&(e=`*${t}*:\n ${e}`);const a={read:1,fromMe:!0,mediaUrl:"",body:e,scheduleDate:this.isScheduleDate?this.scheduleDate:null,quotedMsg:this.replyingMessage,idFront:Object(H["a"])()};return this.isScheduleDate&&(a.scheduleDate=this.scheduleDate),a},async enviarMensagem(){if(this.isScheduleDate&&!this.scheduleDate)return void this.$notificarErro("Para agendar uma mensagem, informe o campo Data/Hora Agendamento.");this.loading=!0;const e=this.ticketFocado.id,t=this.cMostrarEnvioArquivo?this.prepararUploadMedia():this.prepararMensagemTexto();try{if(!this.cMostrarEnvioArquivo&&!this.textChat)return;await Object(d["i"])(e,t),this.arquivos=[],this.textChat="",this.$emit("update:replyingMessage",null),this.abrirFilePicker=!1,this.abrirModalPreviewImagem=!1,setTimeout((()=>{this.scrollToBottom()}),300)}catch(a){this.isRecordingAudio=!1,this.loading=!1,this.$notificarErro("Ocorreu um erro!",a)}this.isRecordingAudio=!1,this.loading=!1,setTimeout((()=>{this.$refs.inputEnvioMensagem.focus()}),300)},handlerInputMensagem(e){this.textChat=e.target.value},showModalPreviewImagem(){this.$nextTick((()=>{setTimeout((()=>{this.$refs.qbtnPasteEnvioMensagem.$el.focus()}),20)}))},hideModalPreviewImagem(){this.arquivos=[],this.urlMediaPreview={},this.abrirModalPreviewImagem=!1},onRejectedFiles(e){this.$q.notify({html:!0,message:"Ops... Ocorreu um erro! <br>\n        <ul>\n          <li>Cada arquivo deve ter no máximo 10MB.</li>\n          <li>Em caso de múltiplos arquivos, o tamanho total (soma de todos) deve ser de até 30MB.</li>\n        </ul>",type:"negative",progress:!0,position:"top",actions:[{icon:"close",round:!0,color:"white"}]})},handleSign(e){this.sign=e,K["a"].set("sign",this.sign)}},mounted(){this.$root.$on("mensagem-chat:focar-input-mensagem",(()=>this.$refs.inputEnvioMensagem.focus()));const e=this;window.addEventListener("paste",e.handleInputPaste),[null,void 0].includes(K["a"].getItem("sign"))||this.handleSign(K["a"].getItem("sign"))},beforeDestroy(){const e=this;window.removeEventListener("paste",e.handleInputPaste)},destroyed(){this.$root.$off("mensagem-chat:focar-input-mensagem")}},ne=se,oe=(a("d753"),a("52ee")),re=a("8f8e"),ce=a("27f9"),le=a("7d53"),de=a("ee89"),me=Object(h["a"])(ne,U,V,!1,null,"76638681",null),ue=me.exports;z()(me,"components",{QDate:oe["a"],QMenu:A["a"],QList:$["a"],QItem:f["a"],QItemSection:q["a"],QItemLabel:y["a"],QTooltip:C["a"],QBtn:b["a"],QCheckbox:re["a"],QInput:ce["a"],QFile:le["a"],QSkeleton:w["a"],QDialog:T["a"],QCard:P["a"],QCardSection:R["a"],QImg:k["a"],QUploader:de["a"],QCardActions:D["a"]}),z()(me,"directives",{ClosePopup:j["a"]});var pe=a("fcbb"),he=a("0b67"),ge=a("e166"),ve=a.n(ge),be=a("73ad"),fe={name:"Chat",mixins:[n["a"],pe["a"],he["a"]],props:{mensagensRapidas:Array},components:{InforCabecalhoChat:B,MensagemChat:N["a"],InputMensagem:ue,InfiniteLoading:ve.a},data(){return{scrollIcon:!1,loading:!1,exibirContato:!1,heigthInputMensagem:0,params:{ticketId:null,pageNumber:1},agendamentoMensagem:{scheduleDate:""},replyingMessage:null,modalAgendamentoMensagem:!1,modalEncaminhamentoMensagem:!1,mensagemEncaminhamento:{},mensagensParaEncaminhar:[],ativarMultiEncaminhamento:!1,contatoSelecionado:{id:"",name:""},contatos:[]}},computed:{cMessages(){return this.replyingMessage=null,this.mensagensTicket},style(){return{backgroundColor:"red"}},cStyleScroll(){const e=0,t=this.heigthInputMensagem+e;return`min-height: calc(100vh - ${62+t}px); height: calc(100vh - ${62+t}px); width: 100%`}},methods:{async onResizeInputMensagem(e){this.heigthInputMensagem=e.height},async onLoadMore(e){var t;if(!this.loading){if(!this.hasMore||null===(t=this.ticketFocado)||void 0===t||!t.id)return e.complete();try{this.loading=!0,this.params.ticketId=this.ticketFocado.id,this.params.pageNumber+=1,await this.$store.dispatch("LocalizarMensagensTicket",this.params),this.loading=!1,e.loaded()}catch(a){e.complete()}this.loading=!1}},scrollArea(e){this.hideOptions=!0,setTimeout((()=>{e&&(this.scrollIcon=e.verticalSize-(e.verticalPosition+e.verticalContainerSize)>2e3)}),200)},scrollToBottom(){document.getElementById("inicioListaMensagensChat").scrollIntoView()},abrirModalEncaminharMensagem(e){this.mensagemEncaminhamento=e,this.modalEncaminhamentoMensagem=!0},async localizarContato(e,t,a){if(e.length<2)return this.contatos.length&&t((()=>{this.contatos=[...this.contatos]})),void a();this.loading=!0;const{data:i}=await Object(be["f"])({searchParam:e});t((()=>{i.contacts.length?this.contatos=i.contacts:this.contatos=[{}]})),this.loading=!1},cancelarMultiEncaminhamento(){this.mensagensParaEncaminhar=[],this.ativarMultiEncaminhamento=!1},confirmarEncaminhamentoMensagem(e){this.contatoSelecionado.id?Object(d["h"])(e,this.contatoSelecionado).then((e=>{this.$notificarSucesso(`Mensagem encaminhada para ${this.contatoSelecionado.name} | Número: ${this.contatoSelecionado.number}`),this.mensagensParaEncaminhar=[],this.ativarMultiEncaminhamento=!1})).catch((e=>{this.$notificarErro("Não foi possível encaminhar mensagem. Tente novamente em alguns minutos!",e)})):this.$notificarErro("Selecione o contato de destino das mensagens.")}},created(){this.$root.$on("scrollToBottomMessageChat",this.scrollToBottom),this.socketTicket()},mounted(){this.socketMessagesList()},destroyed(){this.$root.$off("scrollToBottomMessageChat",this.scrollToBottom)}},qe=fe,xe=(a("c1a7"),a("4983")),ke=a("7ff0"),ye=a("54e1"),we=a("3980"),Me=Object(h["a"])(qe,i,s,!1,null,null,null);t["default"]=Me.exports;z()(Me,"components",{QScrollArea:xe["a"],QIcon:_["a"],QBtn:b["a"],QFooter:ke["a"],QSeparator:I["a"],QList:$["a"],QItem:f["a"],QCard:P["a"],QItemSection:q["a"],QItemLabel:y["a"],QBanner:ye["a"],QSelect:Q["a"],QResizeObserver:we["a"],QDialog:T["a"],QCardSection:R["a"],QCardActions:D["a"]}),z()(Me,"directives",{ClosePopup:j["a"]})},"999e":function(e,t,a){},c1a7:function(e,t,a){"use strict";a("1d5c")},cd32:function(e,t,a){"use strict";a("999e")},d753:function(e,t,a){"use strict";a("fe2a")},fe2a:function(e,t,a){}}]);